<% content_tag_for(:li,item) do %>
	<% if is_page %>
		<% if item.published and !authorized? %>
			<%= link_to item.short_name, [section,item], :class => ( item == @page ? " current" : " notcurrent" ) %>
		<% elsif authorized? %>
			<%= link_to item.short_name, [section,item], :class => ( item == @page ? " current" : " notcurrent" ) + " " + ( item.published ? "published" : "unpublished" ) %>
		<% end %>
	<% else %>
		<% if item.published and !authorized? %>
			<%= link_to item.short_name, item, :class => ( item == @section ? " current" : " notcurrent" ) %>
		<% elsif authorized? %>
			<%= link_to item.short_name, item, :class => ( item == @section ? " current" : " notcurrent" ) + " " + ( item.published ? "published" : "unpublished" ) %>
		<% end %>
		<% unless item.children.blank? and item.pages.blank? %>
			<% content_tag(:ul, :class => "level-#{item.ancestors.size}") do %>
				<% if show_pages %>
					<%= render :partial => "common/menu_item", :collection => ( authorized? ? item.pages : item.pages.find(:all, :order => :position, :conditions => { :published => true })), :as => :item, :locals => { :is_page => true, :section => item, :show_pages => show_pages } %>
				<% end %>
				<%= render :partial => "common/menu_item", :collection => ( authorized? ? item.children : item.children.find(:all, :order => :position, :conditions => { :published => true})), :as => :item, :locals => { :is_page => false, :show_pages => show_pages } %>
			<% end %>
		<% end %>
	<% end %>
<% end %>